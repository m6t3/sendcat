#!/bin/bash

FILE=$1
PORT=1212

echo "Ciao, $USER"
if [ -f "$FILE" -o -d "$FILE" ]
then
	MODE=0
	echo "Verrà inviato il file $FILE, premere ENTER per continuare, CTRL+C per terminare"
	read
	if [ -d "$FILE" ]
	then
		echo "Il file da inviare è una cartella, verrà prima compresso"
		tar cPf /tmp/sendcat-tmp.tar "$FILE"
		FILE="/tmp/sendcat-tmp.tar"
		echo "Compressione eseguita"
	fi
else
	MODE=1
	echo "Verrà ricevuto il file $FILE, premere ENTER per continuare, CTRL+C per terminare"
	read
fi

echo "Potrebbe essere necessario richiedere la password per configurare la rete"

sudo service network-manager stop

RECIP=12.12.12.12
SENIP=12.12.12.13

if [ $MODE -eq 1 ]
then
	sudo ifconfig eth0 $RECIP up
	echo "In ricezione"
	nc -l $PORT > $FILE
else
	sudo ifconfig eth0 $SENIP up
	echo "In invio"
	nc $RECIP $PORT < "$FILE"
fi

echo "Trasferimento completato!"
sudo service network-manager start

if [ -f /tmp/sendcat-tmp.tar ]
then 
	rm /tmp/sendcat-tmp.tar
fi

exit 0
